## Пересылка сообщений

### Проект пересылки сообщений из разных каналов (чатов, ботов) в общий канал

Проект позволяет собирать сообщения из указанных каналов и пересылать их в
общий канал, чтобы не просматривать сообщения по отдельным чатам.
При необходимости можно обновить список каналов для поиска.

### Подготовка к запуску проекта

- перейти на страницу https://my.telegram.org/
- В поле "Your Phone Number" введите Ваш номер телефона и нажмите "Next". На этот номер будет отправлено сообщение в Телеграм, который нам понадобится в следующем пункте.
- После этого у Вас появится поле Confirmation code. В это поле Вам необходимо вставить код, который Вы получите в приложении Telegram на телефоне или компьютере и нажать на кнопку "Sign In".
- Далее нажимаем на ссылку "API development tools"
- Создать новое приложение, заполнив поля "App title" и "Short name". "Platform" - можно выбрать “Other (specify in description)”. Остальные параметры можно оставить пустыми. Нажимаем "Create application"
- После того как все шаги выполнены вы получите собственные APP API_ID и APP API_Hash. Если вы уже получали такие ключи ранее, то можно использовать их
- Создать общий канал в Телеграм

### Настройка проекта

- Клонируем проект
- Устанавливаем poetry
~~~
pip install poetry
~~~
- Переходим в папку с проектом и устанавливаем зависимости
~~~
poetry install
~~~
- Создаем в папке проекта файл .env
- Записываем туда свои данные по образцу файла .env.sample:
~~~
TELEGRAM_API_ID=Ваш app api_id
TELEGRAM_API_HASH=Ваш app api_hash
TELEGRAM_USERNAME=Ваш username в Телеграме без символа @
GENERAL_CHANNEL_ID=-1001234567890 (ID вашего канала, куда будут пересылаться сообщения)
~~~
- GENERAL_CHANNEL_ID можно получить в конце после настройки проекта
- Записываем в файл my_channels.txt каналы, из которых будут пересылаться сообщения. Каждое название на отдельной строке. Пример можно увидеть в файле
- Перейти в файл services.py и в конце файла в точке входа в исполняемую функцию записать имя созданного общего канала и запустить файл на выполнение
- При первом запуске в терминале ввести свой номер телефона, на который придет код подтверждения в Телеграм. Ввести этот код в терминале и нажать Enter. Если все ввели правильно, в корне проекта будет создан файл username.session. По этому файлу Телеграм отслеживает ваше использование программы (не надо будет постоянно вводить номер телефона) и ваше нахождение в закрытых группах. Не удаляйте этот файл. При переносе проекта на сервер, этот файл также перенсти.
- После этого в терминале выведется список каналов, подходящих по имени (если название введено полностью, обычно бывает первым в списке) если ID будет 10-значным, добавить впереди префикс -100
    #### пример: 1234567890 --> -1001234567890
- Записать полученный ID в файл .env в поле GENERAL_CHANNEL_ID=

### Запуск проекта

- Запустить файл channels.py. Программа произведет поиск каналов из вашего списка и последние сообщения в этих каналах. Если в списке есть приватные каналы, то вы должны в них состоять. Иначе получать сообщения из них будет невозможно. После завершения работы программы формируется файл last_messages.json, в котором хранятся данные в виде:
    #### ID канала: ID последнего сообщения в канале
    при последующем запуске пересылки сообщений, берутся сообщения начиная от этих данных
- После того, как получены данные из каналов, можно запускать файл copy_messages.py. В общий канал пересылаться будут сообщения, которые еще не пересылались. Если новых сообщений нет, в терминал выводится соответствующее сообщение
